@main
struct ShelfScanDemoApp: App {
    @StateObject private var inferenceViewModel = InferenceViewModel()
    @StateObject var tokenViewModel = TokenViewModel(networkService: NetworkService(keychainService: KeychainService.standard))

    var body: some Scene {
        WindowGroup {
            HomePageView(inferenceViewModel: inferenceViewModel)
                .environmentObject(tokenViewModel)
                .onAppear {
                    tokenViewModel.fetchToken()
                    // Clear cache on app start
                    clearCoreMLCacheOnStart()
                }
        }
    }
    
    private func clearCoreMLCacheOnStart() {
        let cacheURL = FileManager.default.urls(for: .cachesDirectory, in: .userDomainMask)[0]
        let coreMLCacheURL = cacheURL.appendingPathComponent("org.tensorflow.lite.coreml")
        
        do {
            if FileManager.default.fileExists(atPath: coreMLCacheURL.path) {
                try FileManager.default.removeItem(at: coreMLCacheURL)
                print("üóëÔ∏è Cleared Core ML cache on app start")
            }
        } catch {
            print("‚ùå Failed to clear cache: \(error)")
        }
    }
}
